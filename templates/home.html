{% extends "base.html" %}
{% set active_page = "home" %}

{% block title %}Home{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
<!-- Hero -->
<div class="mb-6 animate-in">
    <h1 class="text-xl font-bold" style="color:#005c69;">Lead Pipeline</h1>
    <p class="mt-1 text-sm" style="color:#3c4858;opacity:0.6;">Discover, enrich, score, and import creators into HubSpot</p>
</div>

<!-- Stats strip (HTMX-powered) -->
<div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mb-6 animate-in" style="animation-delay:0.04s;"
     hx-get="/partials/dashboard-stats"
     hx-trigger="load, every 8s"
     hx-swap="innerHTML">
    <div class="card kpi-card">
        <div class="kpi-label">Total Runs</div>
        <div class="kpi-value">-</div>
    </div>
    <div class="card kpi-card">
        <div class="kpi-label">Active Now</div>
        <div class="kpi-value" style="color:#00b2c9;">-</div>
    </div>
    <div class="card kpi-card">
        <div class="kpi-label">Profiles Found</div>
        <div class="kpi-value">-</div>
    </div>
    <div class="card kpi-card">
        <div class="kpi-label">Synced to CRM</div>
        <div class="kpi-value">-</div>
    </div>
</div>

<!-- Quick actions -->
<div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-8 animate-in" style="animation-delay:0.08s;">
    <a href="/discovery" class="card p-5 flex items-start gap-4 transition-shadow group" style="border-left:3px solid #00b2c9;">
        <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0" style="background:#e8f8fa;color:#005c69;">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="none"><circle cx="7" cy="7" r="5" stroke="currentColor" stroke-width="1.5"/><path d="M14.5 14.5L10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </div>
        <div class="flex-1 min-w-0">
            <div class="font-semibold text-sm" style="color:#005c69;">New Discovery</div>
            <div class="text-xs mt-0.5" style="color:#3c4858;opacity:0.5;">Launch a run across Instagram, Patreon, Facebook, and more</div>
        </div>
        <div class="text-gray-300 group-hover:text-teal transition-colors mt-1">&#8594;</div>
    </a>

    <a href="/runs" class="card p-5 flex items-start gap-4 transition-shadow group" style="border-left:3px solid #005c69;">
        <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0" style="background:#e8f8fa;color:#005c69;">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="none"><path d="M2 4H14M2 8H14M2 12H10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
        </div>
        <div class="flex-1 min-w-0">
            <div class="font-semibold text-sm" style="color:#005c69;">Pipeline Runs</div>
            <div class="text-xs mt-0.5" style="color:#3c4858;opacity:0.5;">Track runs through the 6-stage pipeline</div>
        </div>
        <div class="text-gray-300 group-hover:text-teal transition-colors mt-1">&#8594;</div>
    </a>

    <a href="/evaluation" class="card p-5 flex items-start gap-4 transition-shadow group" style="border-left:3px solid #10b981;">
        <div class="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0" style="background:#e8f8fa;color:#005c69;">
            <svg width="20" height="20" viewBox="0 0 16 16" fill="none"><rect x="2" y="2" width="12" height="12" rx="2" stroke="currentColor" stroke-width="1.5"/><path d="M5 10L7 7L9.5 9L11 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
        <div class="flex-1 min-w-0">
            <div class="font-semibold text-sm" style="color:#005c69;">Evaluation</div>
            <div class="text-xs mt-0.5" style="color:#3c4858;opacity:0.5;">Channel performance, funnel health &amp; scoring quality</div>
        </div>
        <div class="text-gray-300 group-hover:text-teal transition-colors mt-1">&#8594;</div>
    </a>
</div>

<!-- API Health (HTMX-powered) -->
<div class="animate-in mb-6" style="animation-delay:0.1s;">
    <h2 class="section-label mb-3">API Health</h2>
    <div id="api-health-panel"
         hx-get="/partials/api-health"
         hx-trigger="load, every 30s"
         hx-swap="innerHTML">
        <div class="card p-3 text-center text-xs" style="color:#3c4858;opacity:0.3;">Loading...</div>
    </div>
</div>

<!-- Recent runs (HTMX-powered) -->
<div class="animate-in" style="animation-delay:0.12s;">
    <div class="flex items-center justify-between mb-3">
        <h2 class="section-label">Recent Runs</h2>
        <a href="/runs" class="text-xs font-medium" style="color:#00b2c9;">View all &#8594;</a>
    </div>
    <div class="card"
         hx-get="/partials/recent-runs"
         hx-trigger="load, every 8s"
         hx-swap="innerHTML">
        <div class="text-center py-8 text-xs" style="color:#3c4858;opacity:0.3;">Loading...</div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function resetCircuit(name) {
    try {
        const res = await fetch('/api/health/' + name + '/reset', {method: 'POST'});
        if (res.ok) htmx.ajax('GET', '/partials/api-health', {target: '#api-health-panel', swap: 'innerHTML'});
        else showModal('Failed to reset circuit breaker', {type: 'error'});
    } catch(e) { showModal(e.message, {type: 'error'}); }
}
</script>
{% endblock %}
